name: GitHub Actions Demo
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        persist-credentials: false
        fetch-depth: 0
    - name: Generate new app
      run: |
        echo $GITHUB_REF
        export BRANCH=$(echo $GITHUB_REF | cut -d / -f 4)
        echo $BRANCH
        sed  "s/%%BRANCH%%/${BRANCH}/g" job.template > seed-jobs/dev/${BRANCH}.yaml
        ls -la seed-jobs/dev
    - name: Commit files
      run: |
        git config --local user.email "test@example.com"
        git config --local user.name "github-actions[bot]"
        git add seed-jobs/dev/${BRANCH}.yaml
        git commit -m "[skip ci] Add new ${BRANCH} application" -a
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GIT_TOKEN }}
        branch: seed-job
